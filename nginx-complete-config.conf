# Complete NGINX configuration for HRAI Mining Industry HR Position Assessment
# Add this to your NGINX server block for wecare.techconnect.co.id

# Mining Industry HR Position Qualification Assessment - HRAI API
# API endpoints - proxy to Node.js server
location ~ ^/mining-hr/api/(.*) {
    proxy_pass http://localhost:3050/api/$1$is_args$args;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_cache_bypass $http_upgrade;
    proxy_redirect off;
    proxy_buffering off;
    proxy_read_timeout 300;
    proxy_connect_timeout 75;
    client_max_body_size 100M;
    
    # CORS headers for API
    add_header 'Access-Control-Allow-Origin' '*' always;
    add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;
    add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization' always;
    
    # Handle preflight requests
    if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS';
        add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
    }
}

# Serve static files directly from the build directory
location ~ ^/mining-hr/static/(.*) {
    alias /var/www/Ai_Position_Skill/build/static/$1;
    expires 1y;
    add_header Cache-Control "public, immutable";
    try_files $uri =404;
}

# Serve manifest.json and other root files
location ~ ^/mining-hr/(manifest\.json|favicon\.ico|logo.*\.png)$ {
    alias /var/www/Ai_Position_Skill/build/$1;
    expires 1d;
    add_header Cache-Control "public";
    try_files $uri =404;
}

# Main application - serve React app for all non-API, non-static requests
location /mining-hr/ {
    alias /var/www/Ai_Position_Skill/build/;
    try_files $uri $uri/ /mining-hr/index.html;
    
    # Add headers for React app
    add_header Cache-Control "no-cache, no-store, must-revalidate";
    add_header Pragma "no-cache";
    add_header Expires "0";
}

# Handle root /mining-hr redirect
location = /mining-hr {
    return 301 /mining-hr/;
}